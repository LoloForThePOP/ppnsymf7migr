<!DOCTYPE html>

{% set showThemeSelector = showThemeSelector|default(true) %}
{% set allowThemeSelection = showThemeSelector %}
{% set storedTheme = allowThemeSelection and app.user and app.user.profile ? (app.user.profile.extra.theme|default('classic')) : 'classic' %}
{% set resolvedTheme = storedTheme == 'light' ? 'classic' : storedTheme %}
{% set themeVariant = resolvedTheme == 'classic' ? 'classic' : 'custom' %}

<html class="is-loading" data-theme="{{ resolvedTheme }}" data-theme-variant="{{ themeVariant }}">

    <head>

        {# Open Graph enables any web page to become a rich object in a social graph (see https://ogp.me/) #}

        {% macro openGraph (title, siteName, pageUrl, description, type, imageUrl = null, updatedAt = null) %}

            <meta property="og:title" content="{{title}}">
            <meta property="og:site_name" content="{{siteName}}">
            <meta property="og:url" content="{{pageUrl}}">
            <meta property="og:description" content="{{description}}">
            <meta property="og:type" content="{{type}}">

            {% if imageUrl is not empty %}
            
                <meta property="og:image" content="{{imageUrl}}">
            
            {% endif %}

            {% if updatedAt is not empty %}
            
                <meta property="og:updated_time" content="{{updatedAt}}">
            
            {% endif %}

        {% endmacro %}

        <meta charset="UTF-8">

        <meta name="viewport" content="width=device-width, initial-scale=1">


        {# Allow each specific webpage to add more content in head tag #}
        {% block headTag %}{% endblock %}


        {# Favicon set #}

        <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
        <meta name="apple-mobile-web-app-title" content="Propon" />
        <link rel="manifest" href="/site.webmanifest" />


        {# Theme preference for anonymous users (localStorage) #}

        {% if not app.user and allowThemeSelection %}
            <script>
                (function() {
                    try {
                        var storedTheme = localStorage.getItem('propon_theme');
                        if (storedTheme) {
                            if (storedTheme === 'light') {
                                storedTheme = 'classic';
                            }
                            var variant = storedTheme === 'classic' ? 'classic' : 'custom';
                            document.documentElement.setAttribute('data-theme', storedTheme);
                            document.documentElement.setAttribute('data-theme-variant', variant);
                        }
                    } catch (e) {}
                })();
            </script>
        {% endif %}
        <script>
            (function() {
                var root = document.documentElement;
                function markReady() {
                    root.classList.add('theme-ready');
                }
                if (window.requestAnimationFrame) {
                    requestAnimationFrame(function() {
                        requestAnimationFrame(markReady);
                    });
                } else {
                    setTimeout(markReady, 0);
                }
            })();
        </script>
        <script>
            (function() {
                var root = document.documentElement;
                var overlay;

                function getOverlay() {
                    if (!overlay) {
                        overlay = document.querySelector('.propon-loader-overlay');
                    }
                    return overlay;
                }

                function setLoading(loading) {
                    root.classList.toggle('is-loading', loading);
                    var element = getOverlay();
                    if (element) {
                        element.setAttribute('aria-hidden', loading ? 'false' : 'true');
                    }
                }

                window.ProponLoader = {
                    show: function() {
                        setLoading(true);
                    },
                    hide: function() {
                        setLoading(false);
                    },
                    toggle: function(force) {
                        if (typeof force === 'boolean') {
                            setLoading(force);
                            return;
                        }
                        setLoading(!root.classList.contains('is-loading'));
                    }
                };

                document.addEventListener('DOMContentLoaded', function() {
                    setLoading(root.classList.contains('is-loading'));
                });

                window.addEventListener('load', function() {
                    setLoading(false);
                });
            })();
        </script>

        {# Google Fonts #}

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
        <script>
            (function() {
                var fontLinksByTheme = {
                    mint: ['family=Quicksand:wght@400;600;700'],
                    dark: ['family=Space+Grotesk:wght@400;600;700'],
                    concentration: ['family=Source+Sans+3:wght@400;600;700'],
                    neon: [
                        'family=Space+Grotesk:wght@400;600;700',
                        'family=Orbitron:wght@400;600;700'
                    ],
                    cyberpunk: [
                        'family=Rajdhani:wght@400;600;700',
                        'family=Oxanium:wght@400;600;700'
                    ],
                    matrix: [
                        'family=IBM+Plex+Sans:wght@400;500;600;700',
                        'family=Space+Mono:wght@400;700'
                    ],
                    vaporwave: [
                        'family=Quicksand:wght@400;600;700',
                        'family=Quicksand:wght@200;300;400'
                    ],
                    'palm-beach': [
                        'family=Quicksand:wght@400;600;700',
                        'family=Manrope:wght@500;600;700'
                    ],
                    'sunny-beach': [
                        'family=Sora:wght@400;500;600;700',
                        'family=Chakra+Petch:wght@500;600;700'
                    ],
                    'retro-game': [
                        'family=Sora:wght@400;500;600;700',
                        'family=Chakra+Petch:wght@500;600;700'
                    ],
                    'eco-green': [
                        'family=Alegreya+Sans:wght@400;600;700',
                        'family=Manrope:wght@500;600;700'
                    ],
                    'pink-lady': [
                        'family=Quicksand:wght@400;600;700'
                    ],
                    'luxury-black': [
                        'family=Source+Sans+3:wght@400;600;700',
                        'family=Cinzel:wght@400;600;700'
                    ],
                    'deep-ocean': [
                        'family=Alegreya+Sans:wght@400;600;700',
                        'family=Space+Grotesk:wght@400;600;700'
                    ]
                };

                var loaded = {};

                function buildUrl(families) {
                    return 'https://fonts.googleapis.com/css2?' + families.join('&') + '&display=swap';
                }

                function loadThemeFonts(theme) {
                    if (!theme || theme === 'classic') {
                        return;
                    }

                    var families = fontLinksByTheme[theme];
                    if (!families || families.length === 0) {
                        return;
                    }

                    var key = families.join('|');
                    if (loaded[key]) {
                        return;
                    }
                    loaded[key] = true;

                    var link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = buildUrl(families);
                    link.media = 'print';
                    link.onload = function() {
                        link.media = 'all';
                    };
                    document.head.appendChild(link);
                }

                window.ProponThemeFonts = {
                    load: loadThemeFonts
                };

                var initialTheme = document.documentElement.getAttribute('data-theme') || 'classic';
                loadThemeFonts(initialTheme);
            })();
        </script>


        <title>{% block title %}Bienvenue sur Propon{% endblock %}</title>


        {# Global CSS #}

        <link href="/css/bootstrap.css" rel="stylesheet"> {# Bootstrap is currently used #}
        <link href="/css/app.css" rel="stylesheet"> {# General stylesheet for Propon #}
        <link href="/css/search_overlay.css" rel="stylesheet">
        <link href="/css/tinymce_theme.css" rel="stylesheet">

        {% block stylesheets %}{% endblock %}


        {% block priorJavascipts %}{% endblock %}

        {# Popper + Bootstrap JS (local build) #}
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" defer></script>
        <script src="/js/bootstrap.js" defer></script>

        {# I know it's outdated but so easy to use #}
        <script src="/js/jquery-3.6.0.js"></script>

        {# Misc js functions like detect if user device is tiny, detect if user is offline... #}
        {# Defines tinyScreen boolean js variable #}
        <script src="/js/misc.js"></script>


        {# Cookies and tracking #}
        
        {% if app.environment != 'dev' %}

            <script src="/js/tracking.js"></script> {# Manages some user tracking #}

            <!-- Google tag (gtag.js) - Google Analytics -->

            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-245896945-1"></script>

            <script>{# Init Google tag #}

                    window.dataLayer = window.dataLayer || [];
                    function gtag(){dataLayer.push(arguments);}
                    gtag('js', new Date());
                    gtag('config', 'UA-245896945-1');
            
            </script>

        {% endif %}



        {# Google Map inclusion by default for geographical searches, along with Google Places(Google places is used for locations autocompletes form fields) #}
            
        <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key | e('url') }}&libraries=places&language=fr" async defer></script>


        {# Allow to add event listeners and dispatch custom events in vanilla js #}

        <script>

            var customEvents = document.createElement("forCustomEvents"); 
            /*
                Ex of use: customEvents.dispatchEvent(new Event("greeting", {'name': Fabien}));
                customEvents.addEventListener("greeting", function(e) { console.log("hello"+e.name); });*/

        </script>





        {# Allow to display some html chunks when user clicks on some buttons instead of reloading the entire webpage #}

        <script> 

            {# storing in a javascript variable the url of the route that manages getting the appropriate html chunk #}
            var getChunkRouteName = '{{url("ajax_render_chunk")}}'; 
            
        </script> 

        {# Manage chunks demand and display #}
        <script src="/js/ajax_chunk.js"></script>

        {# End of js chunks management #}
        


        {% block javascripts %}
        
            
            
        {% endblock %}

    </head>


    <body data-theme-scope="{{ allowThemeSelection ? 'presentation' : 'default' }}">

        {# GDPR Frontend (modal box cookies user selection) #}

        {% include "_partials/GDPR.html.twig" %}

        {# Loader overlay (kept for later use)
        <div class="propon-loader-overlay" aria-hidden="true">
            <div class="propon-loader">
                <span class="propon-loader-pulse"></span>
                {% include "_partials/propon_logo_inline.html.twig" with {
                    logoClass: 'propon-logo propon-loader-logo',
                    logoTitle: 'Propon'
                } %}
            </div>
        </div>
        #}

        {# Header Navbar #}

        {% block header_navbar %}
            {% include "_partials/header_navbar.html.twig" %}
        {% endblock %}

        {# feedback when no internet connection #}

        <div class="no-internet-connection">

            !!! Vous êtes hors-ligne.
            <br>Veuillez vérifiez votre connexion.

        </div>


        <!--Main Content Container -->

        <div class="main-container container-fluid"> 

            <div class="row" style="min-height:500px;">

                <!-- A Sidebar can be used if needed -->
                
                {% block sidebar %}{% endblock %}
                
                <!-- Main Body Content -->

                <div class="col">

                    {# Search experience 

                    to fill

                    {% include "_partials/search_experience.html.twig" %}#}
                    {% include "search/_overlay.html.twig" %}

                    <!-- Flash Messages Display (see app.css for appearance and cosmetic) -->

                    <div id="flash-messages" class="">

                        {# If some flash messages are provided by backend, we display them successively #}

                        {% for label, messages in app.flashes %}
                        
                            <div class="flash-message alert alert-{{label}}">
                        
                                {% for message in messages %}
                        
                                <p class="p-0 m-0 text-center">{{ message|e|nl2br }}</p>
                        
                                {% endfor %}
                        
                            </div>
                    
                        {% endfor %}

                    </div>

                    <!-- End of Flash Messages Display -->

                    {# Main body container #}

                    <div id="main-body-container">
                        
                        {% block body %}{% endblock %}
                                    
                    </div>
                    
                </div>

            </div>

        </div> 



        {# Footer #}

        {% block footer %}
        
            {% include "_partials/footer.html.twig" %}

        {% endblock %}


        {# Fullscreen overlay container used for news creation and similar flows #}
        <div id="fullscreen-overlay" class="overlay-container">
            <div class="close-button">&times;</div>
        </div>

        {# Overlay close button snippet #}
        <script>
            const overlayCloseButton = document.querySelector('#fullscreen-overlay .close-button');
            const overlayContainer = document.querySelector('#fullscreen-overlay');

            overlayCloseButton.addEventListener('click', function() {
                overlayContainer.style.display = 'none';
                overlayContainer.classList.remove('displayFlex');
            });
        </script>

        {# End of overlay snippet #}

        <script src="/js/theme_selector.js"></script>
        <script src="/js/search_overlay.js"></script>
        


    </body>


</html>
