{% embed "utilities/modal_skeleton.html.twig" with {'modal_id': "pp-share", 'modal_size': "modal-lg modal-dialog-centered"} %}

    {% block modalTitle %}

        Partager cette prÃ©sentation

    {% endblock %}

    {% block modalBody %}

        <div class="share-whole-content" data-event-url="{{ path('pp_event', {'stringId': presentation.stringId}) }}">

            <div class="row">

                <div class="col-12 col-lg-7 px-0">

                    <div class="text-container">

                        <div>

                            <h4 class="content-header">Pour faire connaÃ®tre ce projet <br>utilisez un lien de partage direct</h4>

                            <!-- AddToAny BEGIN -->

                            <div class="a2a_kit a2a_kit_size_32 a2a_default_style d-flex justify-content-evenly mb-4">

                                <a class="a2a_button_mastodon"></a>
                                <a class="a2a_button_bluesky"></a>
                                <a class="a2a_button_linkedin"></a>
                                <a class="a2a_button_facebook"></a>
                                <a class="a2a_button_whatsapp"></a>
                                <a class="a2a_button_snapchat"></a>
                                <a class="a2a_button_x"></a>
                                <a class="a2a_button_email"></a>
                                <a class="a2a_dd" href="https://www.addtoany.com/share"></a>

                                <script>
                                    var a2a_config = a2a_config || {};
                                    a2a_config.locale = "fr";
                                </script>

                                <script async src="https://static.addtoany.com/menu/page.js"></script>

                                
                            </div>
                            
                            <!-- AddToAny END -->

                            <p class="pt-2"><span class="share-accent">Ou copiez son adresse et partagez-lÃ  ðŸ‘‡</span></p>

                            {# Check real usage: "Copy link" didn't work on mobile.

                            to do: check on mobile if still relevant

                            <div class="mb-3">{{ absolute_url(path('edit_show_project_presentation', {"stringId": presentation.stringId})) }}</div> #}

                            {# Filled copyable textarea #}

                            <textarea id="presentationAbsoluteURL"
                                      class=""
                                      rows="1"
                                      readonly
                                      autocomplete="off"
                                      aria-label="Adresse de la prÃ©sentation">{{ absolute_url(path('edit_show_project_presentation', {"stringId": presentation.stringId})) }}</textarea>

                            <div class="">
                                    
                                <button type="button" onclick="copyToClipboard('presentationAbsoluteURL', 'copyURLFeedbackBox', 'Adresse copiÃ©e âœ…')" class="copyUrlButton btn fw-bold mt-2 mt-md-3 mb-2">ðŸ‘‰ Copier cette adresse</button>

                                <span id="copyURLFeedbackBox" class="d-block d-md-inline fw-bold"></span>

                            </div>

                        </div>


                        {# Edit StringId Button

                            to do: re-enable if relevant

                        {% if userPresenter and overallQualityAssessment > 1 %}

                            <div class="pp-edition-mode mt-4">

                                <a href="{{ path('edit_pp_string_id', {'stringId': presentation.stringId}) }}">

                                    <button type="button" class="btn btn-light">

                                        Modifier cette adresse

                                    </button>

                                </a>

                            </div>
                        
                        {% endif %} #}

                    </div>
 
                </div>

                <div class="col-12 col-lg-5 d-flex align-items-center justify-content-center px-0">

                    <div class="image-container">

                        <img src="{{asset('share_object.svg', 'pp_consult')}}" alt="Un cercle de personnes en interactions" width="200">

                    </div>

                </div>

            </div>
            
        </div>

    {% endblock %}

    {% block modalFooter %}{% endblock %}


{% endembed %}


<script>

    function logPresentationEvent(type, meta = {}) {
        var container = document.querySelector('#pp-share .share-whole-content');
        if (!container) {
            return;
        }
        var url = container.dataset.eventUrl;
        if (!url) {
            return;
        }
        var payload = { type: type, meta: meta };
        try {
            navigator.sendBeacon(url, JSON.stringify(payload));
        } catch (e) {
            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
                keepalive: true
            }).catch(function () {});
        }
    }

    function copyToClipboard(elementId, feedbackId, feedbackMessage) {

        /* Get the text field */
        var copyText = document.getElementById(elementId);
    
        /* Select the text field */
        copyText.focus();
        copyText.select();
        copyText.setSelectionRange(0, copyText.value.length); /*For mobile devices*/

        /* Copy the text inside the text field */
        navigator.clipboard.writeText(copyText.value).catch(() => {
            document.execCommand("copy");
        });
    
        var feedback = document.getElementById(feedbackId);
        feedback.innerHTML = feedbackMessage;   

        logPresentationEvent('share_copy');
    } 

    document.addEventListener('DOMContentLoaded', function () {
        var shareModal = document.getElementById('pp-share');
        if (shareModal) {
            shareModal.addEventListener('shown.bs.modal', function () {
                logPresentationEvent('share_open');
            });
        }

        var shareKit = document.querySelector('#pp-share .a2a_kit');
        if (shareKit) {
            shareKit.addEventListener('click', function (event) {
                var target = event.target.closest('a');
                if (!target) {
                    return;
                }
                var channel = null;
                target.classList.forEach(function (klass) {
                    if (klass.indexOf('a2a_button_') === 0) {
                        channel = klass.replace('a2a_button_', '');
                    }
                });
                if (channel) {
                    logPresentationEvent('share_external', { channel: channel });
                }
            });
        }
    });

</script>

<style>
    #pp-share .modal-title{
        text-align: center;
        color: var(--theme-title);
    }

    #pp-share .share-whole-content{
        padding: 0 8px;
    }

    #pp-share .share-whole-content .content-header{
        font-size: 1.25rem;
        color: var(--theme-title);
        font-weight: 700;
        margin-bottom: 20px;
    }

    #pp-share .share-whole-content .text-container{
        text-align: center;
        height: 100%;
        padding: 15px 8px;
        font-size: 20px;
        font-weight: 600;
        line-height: 1.1;
        background-color: var(--theme-surface);
        color: var(--theme-text);
    }

    #pp-share .share-whole-content .image-container{
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 15px;
        background-color: var(--theme-surface-alt);
        border: 1px solid var(--theme-border);
        border-radius: 240px;
    }

    #pp-share .share-whole-content .image-container img{
        max-width: 100%;
        height: auto;
    }

    #pp-share textarea{
        width: 100%;
        min-height: 90px;
        resize: none;
        margin-bottom: 10px;
        border: 1px solid var(--theme-border);
        border-radius: 8px;
        background-color: var(--theme-surface-alt);
        color: var(--theme-text);
        font-weight: 700;
        padding: 10px 12px;
    }

    #pp-share textarea:focus{
        border-color: var(--theme-accent);
        outline: none;
    }

    #pp-share #presentationAbsoluteURL{
        white-space: normal;
        text-align: justify;
        -moz-text-align-last: center;
        text-align-last: center;
    }

    #pp-share .copyUrlButton{
        background-color: var(--theme-accent);
        border: 2px solid var(--theme-accent);
        border-radius: 50px;
        color: var(--theme-accent-contrast);
    }

    #pp-share .copyUrlButton:hover,
    #pp-share .copyUrlButton:focus{
        filter: brightness(0.95);
    }

    #pp-share .share-accent,
    #pp-share #copyURLFeedbackBox{
        color: var(--theme-accent);
    }

    @media screen and (max-width: 768px) {
        #pp-share .share-whole-content .text-container{
            font-size: 18px;
        }
    }

    @media screen and (max-width: 580px) {
        #pp-share .share-whole-content .content-header{
            font-size: 1.15rem;
        }

        #pp-share .share-whole-content .text-container{
            text-align: center;
            font-size: 15px;
        }

        #pp-share .share-whole-content .image-container img{
            width: 148px;
        }
        
        #pp-share textarea{
            min-height: 72px;
        }
    }
</style>
