{% macro bookmarkButton(isBookmarkedClass = "") %}

    <div class="bookmark-button {{ isBookmarkedClass ? 'isBookmarked' }} d-flex align-items-center">

        <svg class="bookmarkIcon notFilled" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M6 3.75A2.25 2.25 0 0 0 3.75 6v13.5c0 .6.68.95 1.17.6L12 15.95l7.08 4.15a.75.75 0 0 0 1.17-.6V6A2.25 2.25 0 0 0 18 3.75H6Zm0 1.5h12c.41 0 .75.34.75.75v12.2l-6.37-3.73a.75.75 0 0 0-.76 0l-6.37 3.73V6c0-.41.34-.75.75-.75Z" fill="currentColor"></path>
        </svg>

        <svg class="bookmarkIcon filled" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M6 3.75A2.25 2.25 0 0 0 3.75 6v13.5c0 .6.68.95 1.17.6L12 15.95l7.08 4.15a.75.75 0 0 0 1.17-.6V6A2.25 2.25 0 0 0 18 3.75H6Z" fill="currentColor"></path>
        </svg>

    </div>

{% endmacro %}


{% if not app.user %}

    <a
        href="{{ path('app_login') }}"
        class="d-inline-flex align-items-center"
        aria-label="Se connecter pour enregistrer ce projet"
        title="Se connecter pour enregistrer ce projet"
    >
        {{ _self.bookmarkButton() }}
    </a>

{% else %}

    {% set isBookmarked = presentation.id is defined ? app.user.hasBookmarkedProjectId(presentation.id) : presentation.isBookmarkedBy(app.user) %}

    <a
        href="#"
        class="js-ajax-bookmark-pp-presentation d-inline-flex align-items-center"
        data-url="{{ path('ajax_bookmark_pp', { stringId: presentation.stringId }) }}"
        data-token="{{ csrf_token('bookmark' ~ presentation.stringId) }}"
        aria-label="{{ isBookmarked ? 'Retirer des marque-pages' : 'Ajouter aux marque-pages' }}"
        title="{{ isBookmarked ? 'Retirer des marque-pages' : 'Ajouter aux marque-pages' }}"
    >
        {{ _self.bookmarkButton(isBookmarked ? 'isBookmarked' : '') }}
    </a>

{% endif %}


<style>

    .bookmark-button {
        color: var(--pp-bookmark-icon-color, var(--theme-text));
    }

    .bookmarkIcon {
        width: 22px;
        height: 22px;
    }

    .bookmarkIcon.filled {
        display: none;
    }

    .bookmark-button.isBookmarked .bookmarkIcon.filled {
        display: inline;
    }

    .bookmark-button.isBookmarked .bookmarkIcon.notFilled {
        display: none;
    }

    .js-ajax-bookmark-pp-presentation.is-loading {
        pointer-events: none;
        opacity: 0.68;
    }

    @media screen and (max-width: 580px) {
        .bookmarkIcon {
            width: 18px;
            height: 18px;
        }
    }

</style>


<script>

    if (!window.__ppPresentationBookmarkBound) {
        window.__ppPresentationBookmarkBound = true;

        $(document).on('click', '.js-ajax-bookmark-pp-presentation', function (e) {
            e.preventDefault();
            e.stopPropagation();

            const $tag = $(this);
            if ($tag.data('busy')) {
                return;
            }
            $tag.data('busy', true).addClass('is-loading');

            $.ajax({
                url: $tag.data('url'),
                data: { _token: $tag.data('token') },
                type: 'POST',
                success: function (data) {
                    const $button = $tag.find('.bookmark-button');
                    $button.toggleClass('isBookmarked', data && data.action === 'created');

                    const isBookmarked = $button.hasClass('isBookmarked');
                    const label = isBookmarked ? 'Retirer des marque-pages' : 'Ajouter aux marque-pages';
                    $tag.attr('aria-label', label).attr('title', label);
                },
                error: function () {
                    // Keep silent to avoid visual noise.
                },
                complete: function () {
                    $tag.data('busy', false).removeClass('is-loading');
                }
            });
        });
    }

</script>
