{# Status pills macro #}
{% macro pill(item) %}
    <span class="status-pill-view"
          data-status="{{ item.uniqueName }}"
          data-text="{{ item.short_description_fr }}"
          title="{{ item.description_fr }}">
        {{ item.short_description_fr }}
    </span>
{% endmacro %}

{% import _self as pills %}

{% set items = presentation.getEnumStatusItems() %}
{% set remarks = presentation.statusRemarks|default('') %}
{% set showMore = (items|length > 1) or (remarks|length > 10) %}

<div class="status-summary d-flex align-items-center justify-content-center gap-2 flex-wrap position-relative edit-hoverable-item">
    <span class="status-summary-main">
        {% if items|length > 0 %}
            {{ pills.pill(items|first) }}
        {% elseif remarks %}
            <span class="text-muted small">{{ remarks|slice(0, 30) ~ (remarks|length > 30 ? 'â€¦' : '') }}</span>
        {% endif %}
    </span>

    <button type="button" class="status-popover-btn" {% if not showMore %}style="display:none"{% endif %}>
        Afficher +
    </button>

    {% if userPresenter | default(false) %}
        <a
            class="pp-edition-mode coverable-link"
            href="#"
            data-bs-toggle="modal"
            data-bs-target="#project_status_edition"
            aria-label="Modifier le statut du projet"
        ></a>
    {% endif %}
</div>

{# Hidden full view used by popover #}
<div class="project-statuses-view status-full-view d-none">
    <div class="project-enumerated-statuses-view d-flex flex-wrap gap-2"
         data-current-statuses='{{ presentation.statuses | json_encode }}'
         data-catalog="{{ statusesCatalog | json_encode }}">
        {% for item in items %}
            {{ pills.pill(item) }}
        {% endfor %}
    </div>

    <div class="project-status-remarks-view mt-3 w-100">
        <div class="content">{{ presentation.statusRemarks }}</div>
    </div>
</div>


<style>


    .project-status-remarks-view .content {
        white-space: pre-wrap;
        max-width: 390px;
    }

    .project-statuses-view{
        display: inline-block;
        border: 1px solid var(--theme-border);
        padding: 17px;
        border-radius: 6px;
        max-width: 420px;
        background-color: var(--theme-surface);
    }

    .project-statuses-view .content {
        border: 1px solid var(--theme-border);
        padding: 4px 11px;
        border-radius: 7px;
        background-color: var(--theme-surface-alt);
        color: var(--theme-text);
    }

    .project-statuses {
        margin-top: 1rem;
    }

    .status-pill {
        font-size: 0.9rem;
        color: var(--theme-text);
        border: 1px solid var(--theme-border);
        background-color: var(--theme-surface-alt);
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        cursor: default;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .status-pill-view {
        padding: 5px 10px;
        border-radius: 10px;
        background-color: var(--theme-surface-alt);
        border: 1px solid var(--theme-border);
        color: var(--theme-text);
    }



    .status-pill:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }

    .status-pill.active {
        outline: 2px solid var(--theme-accent);
        font-weight: 600;
    }

    .status-popover-btn {
        position: relative;
        z-index: 6;
        background: var(--theme-surface-alt);
        border: 1px solid var(--theme-border);
        color: var(--theme-text-muted);
        border-radius: 8px;
        cursor: pointer;
        padding: 0px 7px;
        font-size: 0.85rem;
    }

    .wide-popover {
        max-width: 400px !important;
    }

    body[data-theme-scope="presentation"] .status-popover-btn {
        background-color: var(--theme-surface-alt);
        border-color: var(--theme-border);
        color: var(--theme-text);
    }

    body[data-theme-scope="presentation"] .status-popover-btn:hover,
    body[data-theme-scope="presentation"] .status-popover-btn:focus {
        background-color: var(--theme-surface);
        border-color: var(--theme-accent);
        color: var(--theme-accent);
    }

    body[data-theme-scope="presentation"] .wide-popover {
        background-color: var(--theme-surface);
        border-color: var(--theme-border);
        color: var(--theme-text);
    }

    body[data-theme-scope="presentation"] .wide-popover .popover-body {
        color: var(--theme-text);
    }

    body[data-theme-scope="presentation"] .wide-popover .popover-header {
        background-color: var(--theme-surface-alt);
        border-bottom-color: var(--theme-border);
        color: var(--theme-title);
    }

    body[data-theme-scope="presentation"] .wide-popover.bs-popover-top > .popover-arrow::before,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-auto[data-popper-placement^=top] > .popover-arrow::before,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-end > .popover-arrow::before,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-auto[data-popper-placement^=right] > .popover-arrow::before,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-bottom > .popover-arrow::before,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-auto[data-popper-placement^=bottom] > .popover-arrow::before,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-start > .popover-arrow::before,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-auto[data-popper-placement^=left] > .popover-arrow::before {
        border-top-color: var(--theme-border);
        border-right-color: var(--theme-border);
        border-bottom-color: var(--theme-border);
        border-left-color: var(--theme-border);
    }

    body[data-theme-scope="presentation"] .wide-popover.bs-popover-top > .popover-arrow::after,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-auto[data-popper-placement^=top] > .popover-arrow::after,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-end > .popover-arrow::after,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-auto[data-popper-placement^=right] > .popover-arrow::after,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-bottom > .popover-arrow::after,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-auto[data-popper-placement^=bottom] > .popover-arrow::after,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-start > .popover-arrow::after,
    body[data-theme-scope="presentation"] .wide-popover.bs-popover-auto[data-popper-placement^=left] > .popover-arrow::after {
        border-top-color: var(--theme-surface);
        border-right-color: var(--theme-surface);
        border-bottom-color: var(--theme-surface);
        border-left-color: var(--theme-surface);
    }

    body[data-theme-scope="presentation"] .project-statuses-view {
        border-color: var(--theme-border);
        background-color: var(--theme-surface);
    }

    body[data-theme-scope="presentation"] .project-statuses-view .content {
        border-color: var(--theme-border);
        background-color: var(--theme-surface-alt);
        color: var(--theme-text);
    }
</style>
