{% extends 'base.html.twig' %}


 {# Security Global TWIG variable flagging whether user can present this project #} 

    {% set userPresenter = false %}

    {% if is_granted('edit', presentation) %}
    
        {% set userPresenter = true %}

    {% endif %}



 {# Security Global TWIG variable flagging whether user is an admin #} 

    {% set userAdmin = false %}

    {% if is_granted('ROLE_ADMIN') %}

        {% set userAdmin = true %}

    {% endif %}



{# Setting some presentation metadata for SEO, Open Graph #}

{% set createdAt = presentation.createdAt | date("Y - m - d") %}
{% set creator = presentation.creator.username %}

{# SEO & Open Graph: Providing a page title #}
{# Its composition : "{Project Title} - "(if we got one) + {Project goal (first letter uppercased)} (always got one) #}
{% set OGTitle %}{{ presentation.title ? presentation.title ~ " - " : '' }}{{ presentation.goal[:1] | upper ~ presentation.goal[1:] }}{% endset %}

{# SEO & Open Graph: Providing a page description #}
{% set OGDescription %}{{ presentation.textDescription | slice (0, 220) | striptags }}{% endset %}

{# Open Graph: Providing a page image #}
{# We provide thumbnail url #}

{% set OGImageUrl %}{{ presentation.extra.cacheThumbnailUrl ?: null }}{% endset %}

{# Open Graph asks for a page url #}
{% set OGPageUrl = app.request.uri %}


{% block headTag %}

    {# SEO Meta Tags #}

    <meta name="description" content="{{ OGDescription }}">
    <meta name="author" content="{{ creator }}">
    <meta name="keywords" content="{{ presentation.keywords }}">
    <meta name="date" content="{{ createdAt}}">

    {{ _self.openGraph(OGTitle, 'Propon', OGPageUrl, OGDescription, 'article', OGImageUrl, null) }} {# Called from base.html.twig #}

    {# Propon Project Presentation Page might be accessed with different urls, so we use a canonical tag to provide a central one for SEO #}

    <link rel= "canonical" href= "{{ url ( 'edit_show_project_presentation' , {'stringId' : presentation.stringId }) }}" />

    {# TinyMCE Script only if the user can edit the presentation (add a news, update project description #}

    {% if userPresenter %}

        <script src="https://cdn.tiny.cloud/1/ozugcg6rtcsvf9xx1qfujj2aluoo7ezwd2pfx5xnwf4nhujq/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

    {% endif %}


{% endblock %}

{% block stylesheets %}

    <link href="/css/project_presentation_page.css" rel="stylesheet">
    <link href="/css/comments.css" rel="stylesheet">
    <link href="/css/show_more_less_button.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">

    {# WYSIWYG editor styles only if the user can edit the presentation #}

    {% if userPresenter %}

        <link href="/css/wysiwyg.css" rel="stylesheet">
        <link href="/css/create_news.css" rel="stylesheet">
        <link href="/css/places_autocomplete.css" rel="stylesheet">

    {% endif %}




{% endblock %}


{% block title %}{{OGTitle}}{% endblock %}

{% block body %}


    {% if userPresenter %}

    {% endif %}


    {# Setting some variables #}

    {% set hasKeywords = presentation.keywords is not empty %}

    {% set presentationCategories = presentation.categories %}
    {% set countCategories = presentationCategories | length %}

    {# To do : make sure only presenter can have that #}
    {% set categoriesKeywordsForm = categoriesKeywordsForm is defined ? categoriesKeywordsForm : null %}

    {% set statusesCatalog = constant('App\\\Enum\\\ProjectStatuses::CATALOG') %}


    {% set countComments = presentation.comments | length %}


    {% set likesCount = presentation.likes | length %}


    {% include 'project_presentation/edit_show/share_modal.html.twig' %}
    

    <div class="pp-container {{userPresenter ? 'in-edition-mode' : 'in-consultation-mode'}} container">


        {# statuses catalog #}

        {% set thisProjectActiveStatuses = presentation.getStatuses() %}

        {% include 'project_presentation/edit_show/statuses/edit_box.html.twig' %}





        {% include 'project_presentation/edit_show/upper_box_structure.html.twig' %}



        <div class="container px-0">

            <div class="row">

                {% set countSlides = presentation.slides | length %}
                
                {# Slideshow images & videos #}

                {% include "project_presentation/edit_show/slides/add_image_form.html.twig" %}

                {% include "project_presentation/edit_show/slides/add_video_form.html.twig" %}

                <div class="col-lg-6 pp-struct-container-wrapper {% if countSlides == 0 %} pp-edition-mode {% endif %}">

                    <div id="slideshow-struct-container" class="pp-struct-container">
                            
                        {% include 'project_presentation/edit_show/slides/slides.html.twig' %}

                    </div>
                
                </div>


                {# Text Description #}

                <div class="col-lg-6 pp-struct-container-wrapper">

                    <div id="text-description-struct-container" class="pp-struct-container">
                        
                        {% include 'project_presentation/edit_show/text_description/main.html.twig' %}

                    </div>
                
                </div>

                {# Places #}


                {% set countPlaces = presentation.places | length %}

                <div class="col-lg-6 pp-struct-container-wrapper {% if countPlaces == 0 %} pp-edition-mode {% endif %}">
                    
                    <div id="places-struct-container" class="pp-struct-container">
                        
                    {% include 'project_presentation/edit_show/places/display.html.twig' %}
                    
                    </div>
                
                </div>

                {% set countDocuments = presentation.documents | length %}


                {# Documents #}

                {% include "project_presentation/edit_show/documents/add.html.twig" %}
               
                <div class="col-lg-6 pp-struct-container-wrapper {% if countDocuments == 0 %} pp-edition-mode {% endif %}">

                    <div id="documents-struct-container" class="pp-struct-container">

                        {% include 'project_presentation/edit_show/documents/display.html.twig' %}

                    </div>


                </div>



                {# Questions & Answers #}

                {% set countQA = presentation.getOtherComponents().getComponents('questions_answers') | length %}
                
                {% include "project_presentation/edit_show/questions_answers/add_form.html.twig" %}

                <div class="col-lg-6 pp-struct-container-wrapper {% if countQA == 0 %} pp-edition-mode {% endif %}">
                
                    <div id="questionsAnswers-struct-container" class="pp-struct-container ">
                
                        {% include "project_presentation/edit_show/questions_answers/display.html.twig" %}
                
                    </div>

                </div>




                {# Websites #}

                {% set countWebsites = presentation.getOtherComponents().getComponents('websites') | length %}

                {% include "project_presentation/edit_show/websites/add.html.twig" %}

                <div class="col-lg-6 pp-struct-container-wrapper {% if countWebsites == 0 %} pp-edition-mode {% endif %}">
            
                    <div id="websites-struct-container" class="pp-struct-container col-12">
                    
                        {% include 'project_presentation/edit_show/websites/content.html.twig' %}
                            
                    </div>   
                
                </div>



                


                {# to do: drop or not: Old way reminder:
                
                    Contact Project Members : Business Cards & Private Message Button
                    !!! Also contains "Send Private Message Button" & "Allow - Disallow PM Switcher"
                
                    {% if not presentation.isDeleted and (countBC > 0 or privateMessagesActive or userPresenter) %}
                
                 #}



                {% include "project_presentation/edit_show/business_cards/add.html.twig" %}


                

                {% set countBC = presentation.getOtherComponents().getComponents('business_cards') | length %}


                {% if countBC > 0 %}{% endif %}

                    <div class="col-lg-6 pp-struct-container-wrapper">

                    {# to do: drop or not: Old way reminder: in tag attribute
                
                       <div id="businessCards-struct-container" data-display="{{countBC > 0 or privateMessagesActive ? "true" : "false"}}" class="pp-struct-container col-12">
                
                    #}

                        <div id="businessCards-struct-container" class="pp-struct-container col-12{% if countBC == 0 %} pp-edition-mode {% endif %}">

                            {% include 'project_presentation/edit_show/contact_possibilities.html.twig' %}

                        </div>    
                    
                    </div>

                















            </div>

        </div>




        {% if userPresenter %}

            {# Switch Between Edition Mode and Consultation Mode Button #}

            <button id="pp-switch-edit-consult-mode">

                <img id="pp-consult-icon" class="pp-edition-mode" src="{{ asset('eye.svg', 'pp_wysiwyg')}}" height="30" width="30"  alt="eye icon">

                <img id="pp-edit-icon" class="pp-consultation-mode" src="{{ asset('pen.svg', 'pp_wysiwyg')}}" height="30" width="30"  alt="pen icon">

            </button>

        {% endif %}




        {% include 'project_presentation/edit_show/statuses/javascripts.html.twig' %}



        {% if userPresenter %}
            {% include 'project_presentation/edit_show/places/manage_modal.html.twig' %}
            {% include 'project_presentation/edit_show/reorder_delete_elements.html.twig' %}
            {% include 'project_presentation/edit_show/wysiwyg.html.twig' %}
        {% endif %}

        {% include 'project_presentation/edit_show/_partials/first_time_edit_toggle_hint.html.twig' %}

    </div>
    
{% endblock %}

{% block javascripts %}



<script>

    $(document).ready(function(){

        // initialising inline edit capabilities
        $("[data-edit]").attr('contenteditable','true');


    });

</script>



	{# Image Zoom Only On Large Screens #}

	<script>

		if (!tinyScreen)
		{		
			var head = document.getElementsByTagName('head')[0];
			var js = document.createElement("script");
			js.type = "text/javascript";
			js.src = "/js/image_zoom.js";
			head.appendChild(js);
		}
	
	</script>





{% if userPresenter %}
    {% include 'project_presentation/edit_show/places/_js.html.twig' with { presentation: presentation } %}
{% endif %}

{% endblock %}
