{% extends 'base.html.twig' %}


 {# Security Global TWIG variable flagging whether user can present this project #} 

    {% set userPresenter = false %}

    {% if is_granted('edit', presentation) %}
    
        {% set userPresenter = true %}

    {% endif %}



 {# Security Global TWIG variable flagging whether user is an admin #} 

    {% set userAdmin = false %}

    {% if is_granted('ROLE_ADMIN') %}

        {% set userAdmin = true %}

    {% endif %}



{# Setting some presentation metadata for SEO, Open Graph #}

{% set createdAt = presentation.createdAt | date("Y - m - d") %}
{% set creator = presentation.creator.username %}

{# SEO & Open Graph: Providing a page title #}
{# Its composition : "{Project Title} - "(if we got one) + {Project goal (first letter uppercased)} (always got one) #}
{% set OGTitle %}{{ presentation.title ? presentation.title ~ " - " : '' }}{{ presentation.goal[:1] | upper ~ presentation.goal[1:] }}{% endset %}

{# SEO & Open Graph: Providing a page description #}
{% set OGDescription %}{{ presentation.textDescription | slice (0, 220) | striptags }}{% endset %}

{# Open Graph: Providing a page image #}
{# We provide thumbnail url #}

{% set OGImageUrl %}{{ presentation.extra.cacheThumbnailUrl ?: null }}{% endset %}

{# Open Graph asks for a page url #}
{% set OGPageUrl = app.request.uri %}


{% block headTag %}

    {# SEO Meta Tags #}

    <meta name="description" content="{{ OGDescription }}">
    <meta name="author" content="{{ creator }}">
    <meta name="keywords" content="{{ presentation.keywords }}">
    <meta name="date" content="{{ createdAt}}">

    {{ _self.openGraph(OGTitle, 'Propon', OGPageUrl, OGDescription, 'article', OGImageUrl, null) }} {# Called from base.html.twig #}

    {# Propon Project Presentation Page might be accessed with different urls, so we use a canonical tag to provide a central one for SEO #}

    <link rel= "canonical" href= "{{ url ( 'edit_show_project_presentation' , {'stringId' : presentation.stringId }) }}" />

    {# TinyMCE Script only if the user can edit the presentation (add a news, update project description #}

    {% if userPresenter %}

        <script src="https://cdn.tiny.cloud/1/ozugcg6rtcsvf9xx1qfujj2aluoo7ezwd2pfx5xnwf4nhujq/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

    {% endif %}


{% endblock %}

{% block stylesheets %}

    <link href="/css/project_presentation_page.css" rel="stylesheet">
    <link href="/css/comments.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">

    {# WYSIWYG editor styles only if the user can edit the presentation #}

    {% if userPresenter %}

        <link href="/css/wysiwyg.css" rel="stylesheet">
        <link href="/css/create_news.css" rel="stylesheet">

    {% endif %}

{% endblock %}


{% block title %}{{OGTitle}}{% endblock %}

{% block body %}

    <div class="page-container container m-4">


{# templates/project/_statuses.html.twig #}

{% set catalog = constant('App\\\Enum\\\ProjectStatuses::CATALOG') %}

{% set thisProjectActiveStatuses = presentation.getStatuses() %}

<div class="project-statuses">

    {% for category in catalog %}
        <div class="status-category mb-4">
            <h5 class="fw-bold text-muted mb-2">
                {{ category.categoryLabels.description_fr }}
            </h5>

            <div class="d-flex flex-wrap gap-2">
                {% for item in category.items %}
                {% set isActive = item.uniqueName in thisProjectActiveStatuses %}
                    <div class="status-pill px-3 py-2 rounded-pill {{ isActive ? 'active' }}"
                         style="background-color: {{ item.bg_color }};"
                         title="{{ item.description_fr }}">
                        {{ item.short_description_fr }}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}

</div>



<style>

.project-statuses {
    margin-top: 1rem;
}

.status-pill {
    font-size: 0.9rem;
    color: #222;
    border: 1px solid rgba(0,0,0,0.05);
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    cursor: default;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.status-pill:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.12);
}


.status-pill.active {
    outline: 2px solid #4b9c3f;
    font-weight: 600;
}



</style>


<script>

$(document).on('click', '.status-pill', function() {
    $(this).toggleClass('active');
    // optional: Ajax call to save new statuses
});


</script>









        {% include 'project_presentation/edit_show/_partials/_upper_box.html.twig' %}


        {% for status in presentation.statuses %}
        {% set info = constant('App\\\\Model\\\\ProjectStatus::class').get(status) %}
        <span class="inline-flex items-center px-2 py-1 text-sm font-medium rounded"
                style="background-color: {{ info.color }};">
            {{ info.short }}
        </span>
        {% else %}
        <span class="text-gray-500">Aucun statut d√©fini</span>
        {% endfor %}


        {% include 'project_presentation/edit_show/_partials/_follow_button.html.twig' %}
        {% include 'project_presentation/edit_show/_partials/_like_button.html.twig' %}

    </div>
    
{% endblock %}

{% block javascripts %}

{% endblock %}