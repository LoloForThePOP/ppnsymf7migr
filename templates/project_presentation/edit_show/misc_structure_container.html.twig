{# Misc Info & Buttons #}

<div class="col-lg-6 pp-struct-container-wrapper pp-consultation-mode">

    {% set ingestion = presentation.ingestion ?? null %}
    {% set sourceUrl = ingestion ? ingestion.sourceUrl : null %}
    {% set ingestedAt = ingestion ? ingestion.ingestedAt : null %}
    {% set sourceCreatedAt = ingestion ? ingestion.sourceCreatedAt : null %}
    {% set sourceUpdatedAt = ingestion ? ingestion.sourceUpdatedAt : null %}
    {% set hasAutomationInfo = sourceUrl or ingestedAt or sourceCreatedAt or sourceUpdatedAt %}
    
    <div id="misc-struct-container" class="pp-struct-container d-flex justify-content-center is-expanded" data-pp-default-expanded="true" data-pp-collapse="disabled">

        <div class="flex-wrapper d-flex flex-column align-items-center justify-content-center">

            <div class="d-flex align-items-center misc-primary-actions">
            
                {% include 'project_presentation/edit_show/follow_button.html.twig' %}

                {% set isBookmarked = app.user and presentation.id is defined ? app.user.hasBookmarkedProjectId(presentation.id) : (app.user and presentation.isBookmarkedBy(app.user)) %}
                {% if app.user %}
                    <a
                        href="#"
                        class="bookmark-presentation-button btn js-ajax-bookmark-pp-misc {{ isBookmarked ? 'isBookmarked' }}"
                        data-url="{{ path('ajax_bookmark_pp', { stringId: presentation.stringId }) }}"
                        data-token="{{ csrf_token('bookmark' ~ presentation.stringId) }}"
                        aria-label="{{ isBookmarked ? 'Retirer des marque-pages' : 'Ajouter aux marque-pages' }}"
                        title="{{ isBookmarked ? 'Retirer des marque-pages' : 'Ajouter aux marque-pages' }}"
                    >
                        <svg class="icon bookmarkIcon notFilled" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M6 3.75A2.25 2.25 0 0 0 3.75 6v13.5c0 .6.68.95 1.17.6L12 15.95l7.08 4.15a.75.75 0 0 0 1.17-.6V6A2.25 2.25 0 0 0 18 3.75H6Zm0 1.5h12c.41 0 .75.34.75.75v12.2l-6.37-3.73a.75.75 0 0 0-.76 0l-6.37 3.73V6c0-.41.34-.75.75-.75Z" fill="currentColor"></path>
                        </svg>
                        <svg class="icon bookmarkIcon filled" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M6 3.75A2.25 2.25 0 0 0 3.75 6v13.5c0 .6.68.95 1.17.6L12 15.95l7.08 4.15a.75.75 0 0 0 1.17-.6V6A2.25 2.25 0 0 0 18 3.75H6Z" fill="currentColor"></path>
                        </svg>
                        <div class="text">{{ isBookmarked ? 'Marqué' : 'Marquer' }}</div>
                    </a>
                {% else %}
                    <a href="{{ path('app_login') }}" class="bookmark-presentation-button btn">
                        <svg class="icon bookmarkIcon notFilled" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M6 3.75A2.25 2.25 0 0 0 3.75 6v13.5c0 .6.68.95 1.17.6L12 15.95l7.08 4.15a.75.75 0 0 0 1.17-.6V6A2.25 2.25 0 0 0 18 3.75H6Zm0 1.5h12c.41 0 .75.34.75.75v12.2l-6.37-3.73a.75.75 0 0 0-.76 0l-6.37 3.73V6c0-.41.34-.75.75-.75Z" fill="currentColor"></path>
                        </svg>
                        <div class="text">Marquer</div>
                    </a>
                {% endif %}
            
                <button class="share-presentation-button btn" data-bs-toggle="modal" data-bs-target="#pp-share" type="button">

                    <svg class="icon" width="22" height="22" viewBox="0 0 35.7 36.5" aria-hidden="true" focusable="false">
                        <g transform="translate(-31 -150)">
                            <circle cx="37.3" cy="167" r="6.27" fill="currentColor" fill-rule="evenodd"/>
                            <circle transform="rotate(-17.5)" cx="3.53" cy="190" r="6.27" fill="currentColor" fill-rule="evenodd"/>
                            <path d="m60.8 180-23.3-12" fill="none" stroke="currentColor" stroke-width="3.15"/>
                            <circle transform="matrix(.954 .3 .3 -.954 0 0)" cx="104" cy="-131" r="6.27" fill="currentColor" fill-rule="evenodd"/>
                            <path d="m60.1 155-23.3 12" fill="none" stroke="currentColor" stroke-width="3.15"/>
                        </g>
                    </svg>
                    
                    <div class="text">Partager</div>
                
                </button>

            
            </div>

            {% if hasAutomationInfo %}
                <div class="misc-automation-warning px-2 text-center">
                    <span>Présentation automatisée — veuillez vérifier les informations importantes.</span>
                </div>
            {% endif %}

            {# Misc Buttons Row #}

            <div class="sm-text-center misc-secondary-actions">

                {# Page Info #}

                <button id="misc-page-info-dropdown" data-bs-toggle="dropdown" aria-expanded="false" type="button" class="page-info-btn pp-consultation-mode btn btn-light fw-normal me-2 mb-2">Informations sur la page ▾</button>

                <ul id="misc-page-info-dropdown-content" class="dropdown-menu px-3" aria-labelledby="misc-page-info-dropdown">

                    {{ pageInfo }}

                </ul>
                
                {# Report a Problem Button #}

                <a
                    class="report-problem-btn pp-consultation-mode btn btn-light fw-normal mb-2 text-decoration-none"
                    href="{{ path('contact_us', {'context': 'report_abuse', 'item' : 'project_presentation', 'identifier': presentation.stringId }) }}"
                >
                    Signaler un problème
                </a>


            </div>
        
        </div>
    
    </div>

</div>
