{# Misc Info & Buttons #}

<div class="col-lg-6 pp-struct-container-wrapper pp-consultation-mode">
    
    <div id="misc-struct-container" class="pp-struct-container sm-border-none d-flex justify-content-center is-expanded" data-pp-default-expanded="true" data-pp-collapse="disabled">

        <div class="flex-wrapper d-flex flex-column align-items-center justify-content-center py-md-5">

            <div class="d-flex align-items-center">
            
                {% include 'project_presentation/edit_show/follow_button.html.twig' %}

                {% set isBookmarked = app.user and presentation.isBookmarkedBy(app.user) %}
                {% if app.user %}
                    <a
                        href="#"
                        class="bookmark-presentation-button btn js-ajax-bookmark-pp-misc {{ isBookmarked ? 'isBookmarked' }}"
                        data-url="{{ path('ajax_bookmark_pp', { stringId: presentation.stringId }) }}"
                        data-token="{{ csrf_token('bookmark' ~ presentation.stringId) }}"
                        aria-label="{{ isBookmarked ? 'Retirer des marque-pages' : 'Ajouter aux marque-pages' }}"
                        title="{{ isBookmarked ? 'Retirer des marque-pages' : 'Ajouter aux marque-pages' }}"
                    >
                        <svg class="icon bookmarkIcon notFilled" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M6 3.75A2.25 2.25 0 0 0 3.75 6v13.5c0 .6.68.95 1.17.6L12 15.95l7.08 4.15a.75.75 0 0 0 1.17-.6V6A2.25 2.25 0 0 0 18 3.75H6Zm0 1.5h12c.41 0 .75.34.75.75v12.2l-6.37-3.73a.75.75 0 0 0-.76 0l-6.37 3.73V6c0-.41.34-.75.75-.75Z" fill="currentColor"></path>
                        </svg>
                        <svg class="icon bookmarkIcon filled" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M6 3.75A2.25 2.25 0 0 0 3.75 6v13.5c0 .6.68.95 1.17.6L12 15.95l7.08 4.15a.75.75 0 0 0 1.17-.6V6A2.25 2.25 0 0 0 18 3.75H6Z" fill="currentColor"></path>
                        </svg>
                        <div class="text">{{ isBookmarked ? 'Marqué' : 'Marquer' }}</div>
                    </a>
                {% else %}
                    <a href="{{ path('app_login') }}" class="bookmark-presentation-button btn">
                        <svg class="icon bookmarkIcon notFilled" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M6 3.75A2.25 2.25 0 0 0 3.75 6v13.5c0 .6.68.95 1.17.6L12 15.95l7.08 4.15a.75.75 0 0 0 1.17-.6V6A2.25 2.25 0 0 0 18 3.75H6Zm0 1.5h12c.41 0 .75.34.75.75v12.2l-6.37-3.73a.75.75 0 0 0-.76 0l-6.37 3.73V6c0-.41.34-.75.75-.75Z" fill="currentColor"></path>
                        </svg>
                        <div class="text">Marquer</div>
                    </a>
                {% endif %}
            
                <button class="share-presentation-button btn" data-bs-toggle="modal" data-bs-target="#pp-share" type="button">

                    <img class="icon icon-themed icon-strong" src="{{ asset('share.svg', 'misc')}}" alt="share icon" width="22" height="22">
                    
                    <div class="text">Partager</div>
                
                </button>

            
            </div>

            {% include 'project_presentation/edit_show/share_modal.html.twig' %}    
                        
            {# Misc Buttons Row #}

            <div class="sm-text-center mt-5">

                {# Page Info #}

                <button id="page-info-dropdown" data-bs-toggle="dropdown" aria-expanded="false" type="button" class="page-info-btn pp-consultation-mode btn btn-light fw-normal me-2 mb-2 ">Informations sur la page ▾</button>

                <ul id="page-info-dropdown-content" class="dropdown-menu px-3" aria-labelledby="page-info-dropdown">

                    {{ pageInfo }}

                </ul>
                
                {# Report a Problem Button #}

                <a class="text-decoration-none" href="{{ path('contact_us', {'context': 'report_abuse', 'item' : 'project_presentation', 'identifier': presentation.stringId }) }}">

                    <button type="button" class="report-problem-btn pp-consultation-mode btn btn-light fw-normal mb-2 ">Signaler un problème</button>
                    
                </a>


            </div>
        
        </div>
    
    </div>

</div>

<style>

    #misc-struct-container {
        --follow-button-border: var(--pp-action-border);
        --follow-button-text: var(--pp-action-text);
        --follow-button-bg: var(--pp-action-bg);
    }

    #page-info-dropdown-content {
        max-width: 360px;
    }

    #misc-struct-container .follow-button {

        padding: 8px 16px;
        margin-right: 18px;
        border: 2px solid var(--pp-action-border);
        border-radius: 33px;
        font-size: 22px;
        font-weight: 700;
        color: var(--pp-action-text);
        background-color: var(--pp-action-bg);
        transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;

    }

    #misc-struct-container .follow-button .not-followed-display img {
        width: 34px;
        height: 27px;
        margin-bottom: 3px;
        margin-right: 3px;
    }

    #misc-struct-container .follow-button img.check-icon {
        width: 28px;
        height: 22px;
    }

    #misc-struct-container .follow-button .followed-display .text {

        margin-right: 5px;
        margin-left: 6px;
    }

    #misc-struct-container .report-problem-btn, #misc-struct-container .page-info-btn {

        border-radius: 11px;

    }

    @media (max-width: 575px) {

        #misc-struct-container .follow-button {

            padding: 8px 16px;
            margin-right: 18px;
            font-size: 15px;

        }

        #misc-struct-container .follow-button .followed-display .text{

            margin-right: 2px;

        }

        
        #misc-struct-container .follow-button .not-followed-display img {

            margin-right: 2px;
        }

        #misc-struct-container .follow-button .followed-display img {
            margin-left: 3px;
        }

    }

    .share-presentation-button,
    .bookmark-presentation-button{

        display: flex;
        align-items: center;
        padding: 8px 16px;
        margin-right: 18px;
        border: 2px solid var(--pp-action-border);
        border-radius: 33px;
        color: var(--pp-action-text);
        background-color: var(--pp-action-bg);
        transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;

    }

    .share-presentation-button{
        margin-right: 0;
    }

    .share-presentation-button img,
    .bookmark-presentation-button .bookmarkIcon{

        margin-right: 3px;
        margin-bottom: 1px;

    }

    .bookmark-presentation-button .bookmarkIcon {
        width: 22px;
        height: 22px;
    }

    .bookmark-presentation-button .bookmarkIcon.filled {
        display: none;
    }

    .bookmark-presentation-button.isBookmarked .bookmarkIcon.filled {
        display: inline;
    }

    .bookmark-presentation-button.isBookmarked .bookmarkIcon.notFilled {
        display: none;
    }

    .share-presentation-button .text,
    .bookmark-presentation-button .text{

        display: inline-block;
        font-size: 22px;
        margin-bottom: 3px;
        padding-left: 5px;
        color: inherit;

    }

    @media screen and (max-width: 580px) {

        .share-presentation-button,
        .bookmark-presentation-button{

            padding: 6px 13px;

        }

        .share-presentation-button .icon,
        .bookmark-presentation-button .icon{

            width: 22px;

        }

        .share-presentation-button .text,
        .bookmark-presentation-button .text{

            font-size: 15px;

        }
        
    }

</style>


<script>

    if (!window.__ppMiscBookmarkBound) {
        window.__ppMiscBookmarkBound = true;

        $(document).on('click', '.js-ajax-bookmark-pp-misc', function (e) {
            e.preventDefault();
            e.stopPropagation();

            const $tag = $(this);
            if ($tag.data('busy')) {
                return;
            }

            $tag.data('busy', true).addClass('is-loading');

            $.ajax({
                url: $tag.data('url'),
                data: { _token: $tag.data('token') },
                type: 'POST',
                success: function (data) {
                    $tag.toggleClass('isBookmarked', data && data.action === 'created');

                    const isBookmarked = $tag.hasClass('isBookmarked');
                    const label = isBookmarked ? 'Retirer des marque-pages' : 'Ajouter aux marque-pages';
                    const text = isBookmarked ? 'Marqué' : 'Marquer';
                    $tag.attr('aria-label', label).attr('title', label);
                    $tag.find('.text').text(text);
                },
                error: function () {
                    // Keep silent.
                },
                complete: function () {
                    $tag.data('busy', false).removeClass('is-loading');
                }
            });
        });
    }

</script>
