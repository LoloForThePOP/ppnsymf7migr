{# Html buttons is rendered whether project is followed or not #}

{% macro followButton (isFollowedClass = "") %}

    <div class="follow-button {{ isFollowedClass ? 'isFollowed' }} ">

        <div class="not-followed-display">
            
            <svg class="follow-icon" width="22" height="22" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M4 12h12.17l-4.58 4.59L13 18l7-7-7-7-1.41 1.41L16.17 10H4z" fill="currentColor"/>
            </svg>

            <span class="text">Suivre</span>
        
        </div>

        <div class="followed-display">
            
            <span class="text me-1">Suivi</span>

            <svg class="check-icon" width="14" height="14" viewBox="0 0 10 10" aria-hidden="true" focusable="false">
                <path d="M8.39 1.33a.9.9 0 0 1 1.29 1.27L4.87 8.63a.9.9 0 0 1-1.3.02L.37 5.46a.9.9 0 1 1 1.28-1.28l2.53 2.52L8.37 1.36l.02-.03z" fill="currentColor"/>
            </svg>
        
        </div>

    </div>

{% endmacro %}

{# Logic to display the appropriate button according to user logged in status and follow status #}


{% if not app.user %}
    
    <a href="{{path('app_login')}}" class="d-inline-flex align-items-center">

        {{ _self.followButton() }}

    </a>

{% else %} {# User is logged in #}

    <a 
        class="js-ajax-follow-pp d-inline-flex align-items-center" 
        data-url="{{ path('ajax_follow_pp', { stringId: presentation.stringId }) }}"
        data-token="{{ csrf_token('follow' ~ presentation.stringId) }}"
    >

        {% if presentation.isFollowedBy(app.user) %}

            {{ _self.followButton('isFollowed') }}

        {% else %}

            {{ _self.followButton() }}

        {% endif %}

    </a>

{% endif %}

   
{# Styles for the follow button #}

<style>

    /* These styles are overrided when avoce button is reused elsewhere */

    .follow-button {
        padding: var(--follow-button-padding, 1px 8px);
        border: 2px solid var(--follow-button-border, var(--theme-border));
        border-radius: var(--follow-button-radius, 50px);
        color: var(--follow-button-text, var(--pp-interaction-icon-color, var(--theme-text)));
        background-color: var(--follow-button-bg, transparent);
        transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
        cursor: pointer;
    }

    .follow-button .follow-icon,
    .follow-button .check-icon {
        color: var(--follow-button-icon-color, var(--pp-interaction-icon-color, var(--follow-button-text, var(--theme-text))));
    }

    
    .follow-button > * {
        display: flex;
        align-items: center;
    }
    
    .follow-button .not-followed-display .text {
        margin-right: 2px;
    }


    .follow-button.isFollowed .not-followed-display{
        display: none;
    }

    .follow-button:not(.isFollowed) .followed-display{
        display: none;
    }

</style>


<script>

    $(document).ready(function(){

        $( ".js-ajax-follow-pp" ).on( "click", function(e) {

            e.preventDefault();
            e.stopPropagation();

            const $tag = $(this);
            const url = $tag.data('url');
            const token = $tag.data('token');

            $.ajax({

                url: url,
                data: { _token: token },
                type: "POST",
                
                success: function(data) {

                    $(".follow-button").toggleClass("isFollowed");
                    
                },

                error : function(xhr, textStatus, errorThrown) {

                    console.log(errorThrown);

                }  

            });

        });

    });

</script>
