
{% embed "project_presentation/edit_show/skeletons/update_element.html.twig" %}

    {% block headTag %}<meta name="robots" content="noindex, nofollow" />{% endblock %}

    {% block title %}Thumbnail (Vignette){% endblock %}

    {% block mainContentTitle %}Vignette de pr√©sentation du projet (thumbnail){% endblock %}


    {% block moreInfoButtonLabel %}Aide{% endblock %}

    {% block moreInfoContent %}La vignette (= thumbnail) est l'image qui donne acc√®s √† la pr√©sentation de votre projet. Elle appara√Æt sur la page d'accueil du site, dans le moteur de recherche, et dans les suggestions. Choisissez une vignette qui repr√©sente votre projet et qui donne envie de le d√©couvrir.{% endblock %}    

    {% block mainContent %}
        
        <div class="">

            <div class="mb-5 text-center">

                <h5 class="fw-bold mb-3">Vignette actuelle</h5>

                <div class="thumbnail-status">
                    <div class="thumbnail-current">
                        {% if presentation.getExtra.getCacheThumbnailUrl is not empty %}

                            <img class="thumbnail" src="{{ presentation.getExtra.getCacheThumbnailUrl }}" alt="Presentation Thumbnail">
                    
                        {% else %} {# no cached thumbnail : default avatar #}


                            <div class="avatar-square-rounded avatar-80 mx-auto thumbnail-fallback">
                                
                                <span class="avatar-initial avatar-initial-80">

                                {{ presentation.goal | slice (0,1) | upper }}

                                </span>

                            </div>       

                        {% endif %}
                    </div>

                    <div class="thumbnail-preview-wrapper is-hidden" aria-live="polite">
                        <div class="thumbnail-preview-label">Aper√ßu de la nouvelle vignette</div>
                        <div class="thumbnail-preview">
                            <img class="thumbnail-preview__image" alt="Aper√ßu de la vignette s√©lectionn√©e">
                        </div>
                    </div>
                </div>

            </div>
            
            {% set inputId = form.customThumbnailFile.vars.id %}

            <div class="fw-bold mb-3 h5 text-center"> 
                Pour modifier la vignette cliquez ou d√©posez ci-dessous
            </div>

            <div class="">

                {{ form_errors(form.customThumbnailFile) }}

            </div>
            
            <div class="thumbnail-uploader mt-3">
                <label class="thumbnail-dropzone" for="{{ inputId }}" tabindex="0" role="button" aria-controls="{{ inputId }}">
                    <span class="thumbnail-dropzone__icon">üñºÔ∏è</span>
                    <span class="thumbnail-dropzone__title">D√©poser une image</span>
                    <span class="thumbnail-dropzone__hint">ou cliquer pour s√©lectionner un fichier</span>
                    <span class="thumbnail-dropzone__meta">PNG, JPG, WEBP, AVIF ‚Äî max 10 MB</span>
                </label>

                {{ form_widget(form.customThumbnailFile, {
                    attr: {
                        class: 'thumbnail-input js-thumbnail-input'
                    }
                }) }}
            </div>

            {% if presentation.customThumbnail is not empty %}
                <div class="thumbnail-remove mt-4 text-center">
                    <button
                        type="submit"
                        class="btn btn-outline-danger"
                        name="remove_custom_thumbnail"
                        value="1"
                        formnovalidate
                        onclick="return confirm('Supprimer la vignette personnalis√©e ? La vignette reviendra sur une image issue des slides, du logo, ou une vignette par d√©faut.');"
                    >
                        Supprimer la vignette personnalis√©e
                    </button>
                    <div class="thumbnail-remove__hint mt-2">
                        Cette action retire uniquement la vignette personnalis√©e.
                    </div>
                </div>
            {% endif %}
            
        </div>

        
        <div class="d-none">

            {{ form_rest(form) }}

        </div>


        <style>
        
            .thumbnail{

                max-width: 300px;
                max-height: 300px;

            }

            .thumbnail-status{
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: flex-start;
                gap: 24px;
            }

            .thumbnail-current,
            .thumbnail-preview-wrapper{
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .thumbnail-preview-wrapper.is-hidden{
                display: none;
            }

            .thumbnail-preview-label{
                font-weight: 600;
                color: var(--theme-text-muted);
            }

            .thumbnail-uploader{
                display: grid;
                gap: 16px;
                justify-items: center;
            }

            .thumbnail-dropzone{
                width: min(420px, 100%);
                min-height: 200px;
                border: 2px dashed var(--theme-border);
                border-radius: 16px;
                background-color: var(--theme-surface-alt);
                color: var(--theme-text);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 6px;
                text-align: center;
                cursor: pointer;
                transition: border-color 0.2s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            }

            .thumbnail-dropzone:focus-visible{
                outline: 2px solid var(--theme-accent);
                outline-offset: 4px;
            }

            .thumbnail-dropzone.is-dragover{
                border-color: var(--theme-accent);
                background-color: color-mix(in srgb, var(--theme-accent) 14%, var(--theme-surface));
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
            }

            .thumbnail-dropzone__icon{
                font-size: 26px;
            }

            .thumbnail-dropzone__title{
                font-weight: 700;
                font-size: 18px;
            }

            .thumbnail-dropzone__hint{
                font-size: 14px;
                color: var(--theme-text-muted);
            }

            .thumbnail-dropzone__meta{
                font-size: 12px;
                color: var(--theme-text-muted);
            }

            .thumbnail-preview{
                width: min(300px, 100%);
                aspect-ratio: 1 / 1;
                max-height: 300px;
                border-radius: 16px;
                border: 1px solid var(--theme-border);
                background-color: var(--theme-surface);
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                overflow: hidden;
            }

            .thumbnail-preview__image{
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: none;
            }

            .thumbnail-preview__image.is-visible{
                display: block;
            }

            .thumbnail-input{
                display: none;
            }

            .thumbnail-fallback{
                background-color: color-mix(in srgb, var(--theme-accent) 25%, var(--theme-surface));
                border: 1px solid var(--theme-border);
                color: var(--theme-title);
            }

            .thumbnail-remove__hint{
                font-size: 13px;
                color: var(--theme-text-muted);
            }
            
            @media screen and (max-width: 580px) {

                            
                .thumbnail {
                    max-width: 100%;
                    max-height: 300px;
                }

            }

        </style>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const input = document.querySelector('.js-thumbnail-input');
                const dropzone = document.querySelector('.thumbnail-dropzone');
                const previewWrapper = document.querySelector('.thumbnail-preview-wrapper');
                const previewImage = previewWrapper?.querySelector('.thumbnail-preview__image');

                if (!input || !dropzone || !previewImage || !previewWrapper) {
                    return;
                }

                const showPreview = (file) => {
                    if (!file) {
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        previewImage.src = event.target?.result || '';
                        previewImage.classList.add('is-visible');
                        previewWrapper.classList.remove('is-hidden');
                    };
                    reader.readAsDataURL(file);
                };

                input.addEventListener('change', () => {
                    const file = input.files && input.files[0];
                    showPreview(file);
                });

                dropzone.addEventListener('click', () => {
                    input.click();
                });

                dropzone.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        input.click();
                    }
                });

                ['dragenter', 'dragover'].forEach((eventName) => {
                    dropzone.addEventListener(eventName, (event) => {
                        event.preventDefault();
                        dropzone.classList.add('is-dragover');
                    });
                });

                ['dragleave', 'drop'].forEach((eventName) => {
                    dropzone.addEventListener(eventName, () => {
                        dropzone.classList.remove('is-dragover');
                    });
                });

                dropzone.addEventListener('drop', (event) => {
                    event.preventDefault();
                    const files = event.dataTransfer?.files;
                    if (!files || files.length === 0) {
                        return;
                    }
                    const dt = new DataTransfer();
                    Array.from(files).forEach((file) => dt.items.add(file));
                    input.files = dt.files;
                    input.dispatchEvent(new Event('change', { bubbles: true }));
                });
            });
        </script>
        

    {% endblock %}


     {% block actionButtons %}

        <div class="action-buttons-container text-center">


            {# Back to Result Button #}

            <a 
            
                class="text-decoration-none text-white" 
                href="{{path('edit_show_project_presentation', {'stringId': presentation.stringId })}}#{% block seeResultAnchor %}{% endblock %}">

                <button type="button" class="btn btn-lg btn-go-back mb-2  me-3">Retour</button>

            </a>
            
            {# Update Form Valitation Button #}

            <button class="btn btn-lg btn-validate mb-2">Valider</button>

        </div>

    {% endblock %}

{% endembed %}
