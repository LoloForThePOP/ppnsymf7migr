{% extends 'base.html.twig' %}

{% block title %}Outils de collecte{% endblock %}

{% block body %}
    <div class="container my-4">
        <h1 class="h4 mb-3">Outils de collecte / normalisation</h1>
        <div class="row g-3">
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h2 class="h6">üìù Normaliser un texte brut</h2>
                        <p class="text-muted small">Collez un texte FR/EN, g√©n√©rez le JSON normalis√©, option de persistance.</p>
                        <a class="btn btn-outline-primary mt-auto" href="{{ path('admin_project_normalize') }}">Ouvrir</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h2 class="h6">üåê Normaliser depuis HTML</h2>
                        <p class="text-muted small">Collez le code source d‚Äôune page, extraction lien/image et normalisation.</p>
                        <a class="btn btn-outline-primary mt-auto" href="{{ path('admin_project_normalize_html') }}">Ouvrir</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h2 class="h6">üß™ Prompt to JSON (+ normalize & persist)</h2>
                        <p class="text-muted small">Search + Reasoning.</p>
                        <a class="btn btn-outline-primary mt-auto" href="{{ path('admin_openai_responses') }}">Ouvrir</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h2 class="h6">ü§ñ Collecte scraper</h2>
                        <p class="text-muted small">Lancer la collecte automatique</p>
                        <form method="post" action="{{ path('admin_harvest_run') }}" id="harvest-run-form">
                            <button type="submit" class="btn btn-outline-primary mt-auto d-flex align-items-center gap-2" id="harvest-run-btn">
                                <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                                <span class="btn-text">Lancer depuis l‚Äôadmin</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h2 class="h6">üì• Collecter depuis des URLs</h2>
                        <p class="text-muted small">Collez une liste d‚ÄôURLs, extraction HTML + normalisation IA, option de persistance.</p>
                        <a class="btn btn-outline-primary mt-auto" href="{{ path('admin_project_harvest_urls') }}">Ouvrir</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <h2 class="h6">üìä Suivi Ulule</h2>
                        <p class="text-muted small">Suivre ce qui est import√©, √©ligible ou ignor√©.</p>
                        <a class="btn btn-outline-primary mt-auto" href="{{ path('admin_ulule_catalog') }}">Ouvrir</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('harvest-run-form');
            const btn = document.getElementById('harvest-run-btn');
            if (!form || !btn) return;
            const spinner = btn.querySelector('.spinner-border');
            const btnText = btn.querySelector('.btn-text');
            form.addEventListener('submit', () => {
                if (spinner) spinner.classList.remove('d-none');
                if (btnText) btnText.textContent = 'Traitement en cours...';
                btn.setAttribute('disabled', 'disabled');
            });
        });
    </script>
{% endblock %}
