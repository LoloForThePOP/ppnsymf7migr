{#
  Project presentation card macro.
  Usage:
    {% from '_cards/project_presentation.html.twig' import project_card %}
    {{ project_card(presentation, { image: thumbnailUrl }) }}
#}

{% macro project_card(presentation, opts = {}) %}
    {# Defaults can be overridden when calling the macro #}
    {% set defaults = {
        link: presentation is defined and presentation.stringId is defined ? path('edit_show_project_presentation', {'stringId': presentation.stringId}) : null,
        linkTarget: null,
        image: presentation.extra.cacheThumbnailUrl ?? null,
        fetchImagesLink: null,
        showKeywords: true,
        showMeta: true,
        showViews: true,
        showCreator: false,
        fallbackImageText: 'Aucune image'
    } %}
    {% set options = defaults|merge(opts) %}
    {% set imageUrl = options.image %}
    {% set ariaLabel = presentation.title ?? presentation.goal %}

    <article class="project-card position-relative text-reset">
        {% if options.link %}
            <a
                class="stretched-link" style="z-index: 40;"
                href="{{ options.link }}"
                {% if options.linkTarget %}target="{{ options.linkTarget }}"{% endif %}
                aria-label="{{ ariaLabel }}"
            ></a>
        {% endif %}

        <div class="image-container">
        {% if imageUrl %}
            <img src="{{ imageUrl }}" alt="{{ ariaLabel }}" loading="lazy">
        {% else %}
            <div class="h-100 w-100 d-flex align-items-center justify-content-center bg-light text-muted rounded">
                <small>{{ options.fallbackImageText }}</small>
            </div>
        {% endif %}
        </div>

        {% if options.fetchImagesLink or (options.deleteLink is defined and options.deleteLink) %}
            <div class="admin-actions position-absolute top-0 end-0 p-2 d-flex gap-1" style="z-index: 50;">
                {% if options.fetchImagesLink %}
                    <a class="btn btn-outline-primary btn-sm" href="{{ options.fetchImagesLink }}">Images</a>
                {% endif %}
                {% if options.deleteLink is defined and options.deleteLink %}
                    <form method="post" action="{{ options.deleteLink }}" onsubmit="return confirm('Supprimer dÃ©finitivement ce projet ?');">
                        <button type="submit" class="btn btn-outline-danger btn-sm">Supprimer</button>
                    </form>
                {% endif %}
            </div>
        {% endif %}

        <div class="goal-container">
            {# <div class="goal">{{ presentation.goal }}</div> #}
            {% if presentation.title %}
                <div class="title">{{ presentation.title }}</div>
            {% endif %}
        </div>

        {% if options.showKeywords and presentation.keywords %}
            <div class="keywords px-3 pb-2">{{ presentation.keywords }}</div>
        {% endif %}

        {% if options.showMeta %}
            <div class="other-info-container">
                {% if options.showViews %}
                    {% set views = presentation.extra.viewsCount ?? 0 %}
                    <div class="stat-chunk">{{ views }} vue{% if views > 1 %}s{% endif %}</div>
                {% endif %}
                {% if options.showCreator and presentation.creator is defined %}
                    <div class="stat-chunk">{{ presentation.creator.username }}</div>
                {% endif %}
                {% if presentation.createdAt is defined and presentation.createdAt %}
                    <div class="stat-chunk">{{ presentation.createdAt|date('d/m/Y') }}</div>
                {% endif %}
            </div>
        {% endif %}
    </article>
{% endmacro %}
